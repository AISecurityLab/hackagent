---
sidebar_label: completions
title: hackagent.attacks.AdvPrefix.completions
---

Target model completion generation module.

This module handles the generation of completions from target language models
using adversarial prefixes. It implements the core interaction phase of the
AdvPrefix attack where generated prefixes are used to prompt the target model
and elicit potentially harmful or unwanted responses.

The module provides functionality for:
- Generating completions using adversarial prefixes
- Batched processing for multiple prefix-goal combinations
- Integration with various target model types and APIs
- Response collection and formatting for evaluation
- Error handling and retry logic for robust execution

Completions generated by this module are passed to the evaluation stage to
determine attack success rates.

#### execute

```python
def execute(agent_router: AgentRouter, input_df: pd.DataFrame,
            config: Dict[str, Any], logger: logging.Logger,
            run_dir: str) -> pd.DataFrame
```

Execute Step 6 of the AdvPrefix pipeline: Generate completions using adversarial prefixes.

This function takes the filtered adversarial prefixes from previous pipeline steps
and uses them to generate completions from the target agent. It combines prefixes
with configurable surrogate attack prompts and collects the agent&#x27;s responses
for later evaluation.

**Arguments**:

- `agent_router` - AgentRouter instance configured for the target agent.
  Used to send requests and receive completions from the victim agent.
- `input_df` - DataFrame containing adversarial prefixes from previous steps.
  Expected to have columns: &#x27;prefix&#x27;, and optionally &#x27;goal&#x27;.
- `config` - Configuration dictionary containing completion parameters including:
  - surrogate_attack_prompt: Template or suffix to append to prefixes
  - max_new_tokens_completion: Maximum tokens to generate per completion
  - temperature: Sampling temperature for completion generation
  - n_samples: Number of completion samples per prefix
  - run_id: Run identifier for session management (ADK agents)
- `logger` - Logger instance for tracking completion generation progress.
- `run_dir` - Directory path for saving intermediate results and logs.
  

**Returns**:

  A pandas DataFrame with the input data augmented with new columns:
  - completion: Generated completion text from the target agent
  - s6_raw_request_payload: Request payloads sent to the agent
  - s6_raw_response_status: HTTP status codes from agent responses
  - s6_raw_response_headers: Response headers from agent interactions
  - s6_raw_response_body: Raw response bodies from the agent
  - s6_adapter_specific_events: Agent-specific event data
  - s6_error_message: Error messages if requests failed
  

**Raises**:

- `ValueError` - If agent_router is not provided or lacks required backend_agent
  configuration.
  

**Notes**:

  This step represents the core interaction phase where adversarial prefixes
  are actually used to prompt the target agent. For ADK agents, appropriate
  session management is handled with unique user and session IDs.
  
  The function supports configurable surrogate attack prompts that can be
  either predefined templates (accessed by index) or custom strings with
  optional {prefix} placeholders for dynamic formatting.
  
  Completions are processed sequentially with progress tracking, and
  errors are captured gracefully to allow the pipeline to continue
  processing remaining prefixes.

