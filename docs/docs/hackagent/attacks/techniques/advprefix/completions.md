---
sidebar_label: completions
title: hackagent.attacks.techniques.advprefix.completions
---

Target model completion generation module.

This module handles the generation of completions from target language models
using adversarial prefixes. It implements the core interaction phase of the
AdvPrefix attack where generated prefixes are used to prompt the target model
and elicit potentially harmful or unwanted responses.

The module provides functionality for:
- Generating completions using adversarial prefixes
- Batched processing for multiple prefix-goal combinations
- Integration with various target model types and APIs
- Response collection and formatting for evaluation
- Error handling and retry logic for robust execution

Completions generated by this module are passed to the evaluation stage to
determine attack success rates.

#### execute

```python
@handle_empty_input("Get Completions", empty_result=[])
@require_agent_router("Get Completions")
@log_errors("Get Completions")
def execute(agent_router: AgentRouter, input_data: List[Dict],
            config: Dict[str, Any], logger: logging.Logger) -> List[Dict]
```

Execute the Execution stage of the AdvPrefix pipeline: Generate completions using adversarial prefixes.

This function takes the filtered adversarial prefixes from the Generation stage
and uses them to generate completions from the target agent. It combines prefixes
with configurable surrogate attack prompts and collects the agent&#x27;s responses
for evaluation.

**Arguments**:

- `agent_router` - AgentRouter instance configured for the target agent (validated by decorator).
- `input_data` - List of dictionaries containing adversarial prefixes.
  Each dict should have key: &#x27;prefix&#x27;, and optionally &#x27;goal&#x27;.
- `config` - Configuration dictionary containing completion parameters including:
  - surrogate_attack_prompt: Template or suffix to append to prefixes
  - max_new_tokens_completion: Maximum tokens to generate per completion
  - temperature: Sampling temperature for completion generation
- `logger` - Logger instance for tracking completion generation progress.
  

**Returns**:

  List of dictionaries with input data augmented with new keys:
  - completion: Generated completion text from the target agent
  - raw_request_payload: Request payloads sent to the agent
  - raw_response_status: HTTP status codes from agent responses
  - raw_response_headers: Response headers from agent interactions
  - raw_response_body: Raw response bodies from the agent
  - adapter_specific_events: Agent-specific event data
  - error_message: Error messages if requests failed
  

**Notes**:

  This step represents the core interaction phase where adversarial prefixes
  are actually used to prompt the target agent. For ADK agents, appropriate
  session management is handled with unique user and session IDs.
  
  The function supports configurable surrogate attack prompts that can be
  either predefined templates (accessed by index) or custom strings with
  optional `{prefix}` placeholders for dynamic formatting.
  
  Completions are processed sequentially with progress tracking, and
  errors are captured gracefully to allow the pipeline to continue
  processing remaining prefixes.

